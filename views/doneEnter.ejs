<!DOCTYPE HTML>
<html lang = "en" >
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <title>User Base</title>
    <link rel="stylesheet" href="/public/css/doneEnter.css">
  </head>
<body ng-app="myApp" ng-controller = "myController">
   <a href="/" class = "c">To main</a>
  <div class = "block">
  <h1>User Base</h1>
    <div class = "divtable">
      <table>
        <tr>
          <td class = "naming">Id</td>
          <td class = "naming">NickName</td>
          <td class = "naming">Password</td>
          <td class = "naming">Email</td>
          <td class = "naming">Registration date</td>
          <td class = "naming">Send Message</td>
          <td class = "naming">Delete User</td>
        <tr>
        <tr ng-repeat = "item in dataset">
          <td class = "data">{{item.id}}</td>
          <td class = "data">{{item.name}}</td>
          <td class = "data">{{item.password}}</td>
          <td class = "data">{{item.email}}</td>
          <td class = "data">{{item.time}}</td>
          <td class = "data"><button id = "link" name = "link" onclick="sendEmail()" ng-click="linkUser(item.email)">Link</button></td>
          <td class = "data"><button ng-click="delUser(item.id)">Del User</button></td>
        </tr>
      </table>

      <br><br>
<form name = "myForm" id = "myForm" action="/sendMessage" method="post">

      <div class="message" id = "message">
          <input class = "getter" type="text" name="addEmail" id = "addEmail" value = "{{dataLink}}">
          <input class = "close" name = "close"  value = "Close" onclick="offHide()">
          <input type="text" name="subject" id = "subject" placeholder="Enter subject" autocomplete="off" onclick = "offBorderSubject2()">
          <textarea name="text" rows="5" cols="70" id = "hide" placeholder="Enter your message"></textarea>
          <input class = "send" type="submit" id = "submit" name="submit" value="Send Message">
      </div>
</form>

<div id="result" style = "color : yellow; margin-left: 30px "></div>

    </div>
  </div>

  <script>
  function offBorderSubject2()
  {
     document.getElementById('subject').style.border = '1px solid grey';
  }
  </script>

  <script>
$(function () {
  $("#myForm").submit(function (event) {
    if(document.getElementById('subject').value == '')
    {
      document.getElementById('subject').style.border = '1px solid red';
      return false;
    }
    if(document.getElementById('subject').value != '')
    {
      document.getElementById('subject').style.border = '1px solid grey';
    }
    event.preventDefault();
    $.post("/sendMessage", $(this).serialize());
    document.getElementById("result").innerHTML = "Message sent to user";
    setTimeout(function(){ $('#result').hide(); }, 5000);
    setTimeout(function(){ $('#result').show(); }, 2000);
  })

})
  </script>


  <script>
   function offHide()
   {
     document.getElementById("message").style.display = "none";
     document.getElementById("hide").style.display = "none";
     document.getElementById("result").style.display = "none";
   }
   function sendEmail()
   {
     document.getElementById("message").style.display = 'block';
     document.getElementById("hide").style.display = 'block';
     document.getElementById("hide").value = '';
     document.getElementById("subject").value = '';
   }
  </script>

  <script>

    var myApp = angular.module('myApp',[ ]);

    myApp.controller('myController', ['$scope', '$http', function ($scope,$http){
      $scope.name = '';
      $scope.password = '';

      $scope.getUser = function ()
      {
          $http.get('getDb')
         .then(function(response)
         {
            $scope.dataset = response.data;
         });

      }
      
     $scope.delUser = function(recId)
      {
            console.log(recId);
            if(recId == 1)
            {
              alert("You can't do it");
            }
            else
          {
            if(confirm('Are you sure you want to delete this record ? '))
            {
              $http({method: 'GET', url: '/getDb/delUser?id='+recId})
              .then(function(response)
                {
                    $scope.getUser();
                });
            }
          }
      }

       $scope.linkUser = function(Email)
        {
             $scope.dataLink = document.getElementById('addEmail').innerHTML = Email;
        }

       $scope.getUser();

    }]);

  </script>

</body>
</html>
